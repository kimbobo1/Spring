<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ğŸ¤– Vue REST ğŸ¤–</title>
<style type="text/css">
table {
   width: 90%; border-collapse: collapse;
}
th, td {
   border: 1px solid black; padding: 8px;
}
th {
   background-color: skyblue;
}
body {
   background-color: beige;
   color: black;
   font-family: 'Kyobo Handwriting 2023 wsa';
}
button {
   background-color: skyblue;
   border: 1px solid black;
}
</style>
<script src="https://unpkg.com/vue@3"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
<h2>ğŸ©µ íšŒì› ì •ë³´ ğŸ©µ</h2>
<div id="app">
<form @submit.prevent="saveMember">
   <input v-model="memberForm.name" placeholder="ì´ë¦„ ì…ë ¥" required="required" />&nbsp;
   <input v-model="memberForm.addr" placeholder="ì£¼ì†Œ ì…ë ¥" required />
   <button type="submit">íšŒì› {{memberForm.num ? 'ìˆ˜ì •' : 'ì¶”ê°€'}}</button>
   <!-- num ê°’ì— ë”°ë¼ 'ìˆ˜ì •' ë˜ëŠ” 'ì¶”ê°€' -->
</form><br/>
<table>
   <thead>
      <tr>
         <th>ë²ˆí˜¸</th><th>ì´ë¦„</th><th>ì£¼ì†Œ</th><th>ê´€ë¦¬</th>
      </tr>
   </thead>
   <tbody>
      <tr v-for="member in members" :key="member.num"> <!-- :keyë¡œ ê³ ìœ í‚¤ ì„¤ì • -->
         <td>{{member.num}}</td>
         <td>{{member.name}}</td>
         <td>{{member.addr}}</td>
         <td>
            <button @click="selectMember(member)">ìˆ˜ì •</button>&nbsp;&nbsp;
            <button @click="deleteMember(member.num)">ì‚­ì œ</button>
         </td>
      </tr>
   </tbody>
</table>
</div>

<script type="text/javascript">
const {createApp, ref, onMounted} = Vue;

createApp({
   setup(){
      // ref - ë°˜ì‘í˜• ë°ì´í„°ë¡œ ë™ì‘: Vue ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³€ê²½ë  ë•Œ ìë™ ì¶”ì ë¨. UI ì¬ë Œë”ë§
      const members = ref([]);
      const memberForm = ref({num:null, name:'', addr:''});
      
      // ìë£Œë¥¼ ì½ëŠ”(ğŸŒŸGETğŸŒŸ) ë¹„ë™ê¸° í•¨ìˆ˜ ì‘ì„± 
      const fetchNumbers = async() => {
         const response = await axios.get('/members');
         members.value = response.data;
      };
      
      // íšŒì›ì •ë³´ë¥¼ ìˆ˜ì •(ğŸŒŸPUTğŸŒŸ) / ì¶”ê°€(ğŸŒŸPOSTğŸŒŸ)í•˜ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ ì‘ì„±
      const saveMember = async() => {
         // num ê°’ì´ ì¡´ì¬í•˜ë©´ í•´ë‹¹ íšŒì› ì •ë³´ ìˆ˜ì •, ì—†ìœ¼ë©´ íšŒì› ì¶”ê°€
         if(memberForm.value.num){
            await axios.put(`/members/${memberForm.value.num}`, memberForm.value);  // ë°±í‹±ì—ì„œëŠ” ì™¸ë¶€ê°’ì„ $ì„ ì¨ì„œ ì°¸ì¡°
         } else {
            await axios.post('members', memberForm.value);
         }
         
         // ì…ë ¥ ìë£Œ ì§€ìš°ê¸°
         memberForm.value = ref({num:null, name:'', addr:''});
         
         // ìˆ˜ì • ë˜ëŠ” ì¶”ê°€ í›„ ëª©ë¡ ë³´ê¸°
         fetchNumbers();
      }
      
      // íšŒì› ì‚­ì œ ë¹„ë™ê¸° í•¨ìˆ˜
      const deleteMember = async(num) => {
         await axios.delete(`/members/${num}`);
         
         // ì‚­ì œ í›„ ëª©ë¡ ë³´ê¸°
         fetchNumbers();
      };
      const selectMember = (member) =>{
    	  memberForm.value = {...member}
      }
      
      onMounted(fetchNumbers); // ì»´í¬ë„ŒíŠ¸ê°€ Mount ë˜ë©´ fetchNumbers í˜¸ì¶œ
      return {members, memberForm, saveMember, deleteMember, selectMember};
   }
}).mount('#app');

</script>
</body>
</html>